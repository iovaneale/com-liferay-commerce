@component-name = "portal-commerce"
definition {

	property portal.release = "true";
	property portal.upstream = "true";
	property testray.main.component.name = "Commerce";

	setUp {
		TestCase.setUpPortalInstance();

		User.firstLoginPG();

		ProductMenu.gotoPortlet(
			category = "Configuration",
			panel = "Control Panel",
			portlet = "Search");

		SearchAdministration.executeSearchActions(actionsDescription = "Reindex all search indexes.");
	}

	tearDown {
		var testPortalInstance = PropsUtil.get("test.portal.instance");

		if ("${testPortalInstance}" == "true") {
			PortalInstances.tearDownCP();
		}
		else {
			User.logoutAndLoginPG(
				password = "test",
				userLoginEmailAddress = "test@liferay.com");

			CommerceConfiguration.commerceInitializersTearDown();

			CommerceConfiguration.commerceFrontStoreTearDown();

			CommerceConfiguration.commerceAdminTearDown(
				accountName = "Commerce Account",
				userFirstName = "buyer");

			User.logoutPG();

		}
	}

	test MiniumSiteFullFlow {
		property portal.acceptance = "true";

		ProductMenu.gotoPortlet(
			category = "Users",
			panel = "Control Panel",
			portlet = "Users and Organizations");

		User.addCP(
			userEmailAddress = "buyer@liferay.com",
			userFirstName = "Buyer",
			userLastName = "User",
			userScreenName = "buyer");

		ProductMenu.gotoPortlet(
			category = "Users",
			panel = "Control Panel",
			portlet = "Users and Organizations");

		User.editPasswordCP(
			newPassword = "ttest",
			userEmailAddress = "buyer@liferay.com",
			userScreenName = "buyer");

		CommerceAccelerators.initializeAccelerator(siteName = "Minium");

		ProductMenu.gotoSiteViaLink(site = "Minium");

		Navigator.openWithAppendToBaseURL(urlAppend = "group/Minium");

		Pause(locator1 = "3000");

		CommerceAcceleratorsInitializer.createNewAccountViaFront(
			accountName = "Commerce Account",
			adminEmailAddress = "test@liferay.com");

		CommerceAcceleratorsInitializer.addExistingMemberWithRoleToAccount(
			userEmailAddress = "buyer@liferay.com",
			userFirstName = "Buyer");

		ProductMenu.gotoPortlet(
			category = "Users",
			panel = "Control Panel",
			portlet = "Accounts");

		LexiconEntry.gotoEntryMenuItemNoError(
			menuItem = "Edit",
			rowEntry = "Commerce Account");

		Click(locator1 = "NavBar#ADDRESSES");

		Click(locator1 = "Button#PLUS");

		CommerceEntry.createAccountAddressFromAdmin(
			addressAddress = "Test Address",
			addressCity = "Test City",
			addressCountry = "United States",
			addressName = "Commerce Address",
			addressZipCode = "Test Zip Code");

		User.logoutAndLoginPG(
			password = "test",
			userLoginEmailAddress = "buyer@liferay.com");

		ProductMenu.gotoSite(site = "Minium");

		FrontStore.addProductToCart(
			productName = "ABS Sensor",
			productQuantity = "2",
			productUnitPrice = "50.00");

		CommerceNavigator.gotoMiniumSidebarItem(menuItem = "Pending Orders");

		CommerceAcceleratorsInitializer.reviewOrder(
			accountName = "Commerce Account",
			productName = "ABS Sensor",
			productPrice = "100.00",
			productQuantity = "2",
			productSKU = "MIN93015",
			productUnitPrice = "50.00");

		CommerceCheckout.initializersCheckout(
			addressName = "Commerce Address",
			deliveryType = "Standard",
			site = "Minium");

		CommerceNavigator.gotoMiniumSidebarItem(menuItem = "Placed Orders");

		CommerceAcceleratorsInitializer.reviewOrder(
			accountName = "Commerce Account",
			productName = "ABS Sensor",
			productPrice = "100.00",
			productQuantity = "2",
			productSKU = "MIN93015",
			productUnitPrice = "50.00");
	}

	test SpeedwellSiteFullFlow {
		property portal.acceptance = "true";

		CommerceAccelerators.initializeAccelerator(siteName = "Speedwell");

		ProductMenu.gotoSiteViaLink(site = "Speedwell");

		ProductMenu.gotoPortlet(
			category = "Users",
			panel = "Control Panel",
			portlet = "Accounts");

		LexiconEntry.gotoEntryMenuItemNoError(
			menuItem = "Edit",
			rowEntry = "Test Test");

		Click(locator1 = "NavBar#ADDRESSES");

		Click(locator1 = "Button#PLUS");

		CommerceEntry.createAccountAddressFromAdmin(
			addressAddress = "Test Address",
			addressCity = "Test City",
			addressCountry = "United States",
			addressName = "Commerce Address",
			addressZipCode = "Test Zip Code");

		ProductMenu.gotoSite(site = "Speedwell");

		Click(locator1 = "CommerceAccelerators#SPEEDWELL_TOPBAR_BUTTON");

		CommerceNavigator.gotoSpeedwellTopbarItem(menuItem = "Catalog");

		FrontStore.addProductToCart(
			productName = "ABS Sensor",
			productQuantity = "2",
			productUnitPrice = "50.00");

		Click(locator1 = "CommerceAccelerators#SPEEDWELL_TOPBAR_BUTTON");

		CommerceNavigator.gotoSpeedwellTopbarItem(menuItem = "My Cart");

		CommerceAcceleratorsInitializer.reviewOrder(
			accountName = "Test Test",
			productName = "ABS Sensor",
			productPrice = "100.00",
			productQuantity = "2",
			productSKU = "SPEED93015",
			productUnitPrice = "50.00");

		CommerceCheckout.initializersCheckout(
			addressName = "Commerce Address",
			deliveryType = "Standard",
			site = "Speedwell");

		Click(locator1 = "CommerceAccelerators#SPEEDWELL_TOPBAR_BUTTON");

		CommerceNavigator.gotoSpeedwellTopbarItem(menuItem = "My Account");

		CommerceNavigator.gotoSpeedwellDashboardItem(dashboardItem = "My Orders");

		CommerceAcceleratorsInitializer.reviewOrder(
			accountName = "Test Test",
			productName = "ABS Sensor",
			productPrice = "100.00",
			productQuantity = "2",
			productSKU = "SPEED93015",
			productUnitPrice = "50.00");
	}

}